<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Authenticating with Frankly</title>
    <meta name="keywords" content="Frankly Chat Service Platform" />
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link type="text/css" rel="stylesheet" href="css/main.css">
    <link type="text/css" rel="stylesheet" href="css/bootstrap.css">	
	<link rel="icon" 
	      type="image/png" 
	      href="frankly_favicon_32x32_no_bg.png">
	<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?skin=sunburst"></script>
	<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<script src="js/load_frankly_menus.js"></script>
	
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-65350925-1', 'auto');
	  ga('send', 'pageview');

	</script>

	<script> 
	var frankly_menu = [
	'<ul>',
		'<li><a href="http://franklyinc.github.io/">Getting Started</a></li>',
		'<li><a href="InstallSDK.html">Installing the SDK</a></li>',
		'<li><a href="InitializeSDK.html">Initializing the SDK</a>',
		'<li><a href="Auth.html">Authenticating</a>',
			'<ul>',
				'<li><a href="#overview">Overview</a></li>',
				'<li><a href="#jwt">JWT</a></li>',
				'<li><a href="#auth_flow">Server Authentication</a></li>',
				'<li><a href="#Authentication_Behavior">Authentication Behavior</a></li>',
				'<li><a href="#client_auth">Client Authentication</a></li>',
				'<li><a href="#webclient_auth">Web App Authentication</a></li>',
				'<li><a href="#security">A Note on Security</a></li>',
			'</ul>',
		'</li>',
		'<li><a href="BasicIntegration.html">Basic Integration</a>',
		'<li><a href="AdvancedIntegrations.html">Advanced Integrations</a>',
		'<li><a href="APIReference.html">API Reference</a>',
		'<li><a href="downloads.html">Downloads</a>',
		'<li><a href="Support.html">Contact & Support</a>',
	'</ul>'
	];
	
	
	jQuery(document).ready(function($){
  		set_menu_array(frankly_menu);
  	});
	</script>
	
	<script>
		(function() {
			var cx = '007928927613488122909:hbugzpc0lua';
			var gcse = document.createElement('script');
			gcse.type = 'text/javascript';
			gcse.async = true;
			gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
				'//cse.google.com/cse.js?cx=' + cx;
			var s = document.getElementsByTagName('script')[0];
			s.parentNode.insertBefore(gcse, s);
		})();
	</script>
	
</head>


<body>

<nav class="navbar navbar-inverse" role="navigation" style="z-index:100">
   <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#frankly-navbar-collapse">
         <span class="sr-only">Toggle navigation</span>
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://franklyinc.github.io"><div class="mobile-logo"></div></a>
   </div>
   <div class="collapse navbar-collapse" id="frankly-navbar-collapse">
      <!--Nav Bar List Goes Here-->
   </div>
</nav>

<script>
	jQuery(document).ready(function($){
		load_menus();
	});
</script>

<div class="sidebar-container">

	<div class="sidebar-logo"><a href="http://franklyinc.github.io"></a></div>

	<div class="sidebar-content sidebar-search">

		<form action="search.html">
			<input type="text" class="form-control" name="q" placeholder="Search Frankly docs" aria-describedby="basic-addon2">
		</form>
  
	</div>

	<div class="sidebar-content" id="side-nav-container">
		<!--Side Bar List Goes Here-->
	</div>

</div>



<div class="container container-body">


	<div class="header">
		<h1 class="noborder">
			Authentication
		</h1>

<br>

			<ul>	
				<li><a href="#overview">Overview</a></li>
				<li><a href="#jwt">JWT</a></li>
				<li><a href="#auth_flow">Server Authentication Flow</a></li>
				<li><a href="#Authentication_Behavior">Authentication Behavior</a></li>
				<li><a href="#client_auth">Handling Authentication in the Client</a>
					<ul>
						<li><a href="#ios_auth">iOS SDK</a></li>
						<li><a href="#android_auth">Android SDK</a></li>
						<li><a href="#js_auth">JavaScript SDK</a></li>
						<li><a href="#logging_out">Logging Out</a></li>
					</ul>
				</li>
				<li><a href="#webclient_auth">Web App Authentication</a></li>		
				<li><a href="#security">A Note on Security</a></li>
			</ul>
	
	</div>


<br>
<br>


	<div class="doc">

		<div class="section" id="overview">
			<h3>
				Overview
			</h3>

			<p>
				This document describes how the Frankly Authentication works and what components Frankly partners must build in order to support authentication of their users on Frankly’s platform.
			</p>
		</div>
			

		<div class="section" id="jwt">
			<h3>
				JWT
			</h3>

			<p>
				Frankly Authentication mechanism is based on JWT (JSON Web Token), a web standard for sharing user authentication in a secure way. JWT libraries are provided for all popular programming languages and are referenced at <a href="http://jwt.io/">jwt.io</a>. The full JWT specifications can be found <a href="https://openid.net/specs/draft-jones-json-web-token-07.html">here</a>, the reader should consult and become familiar with how JWT works prior to continuing with this document.
			</p>
		</div>


		<div class="section" id="auth_flow">
			<h3>
				Server Authentication Flow
			</h3>
			
			
<br>


				<div class="section" id="Generate_Nonce">
					<h4>
						1. Generate a Nonce Value	
					</h4>

					<p>
						JSON Web Tokens embed a unique value called nonce which is used to protect against man-in-the-middle attacks by adding a random component to the token in order to make it impossible to predict a valid token.
					</p>

					<p>
						Frankly’s infrastructure provides a public HTTP endpoint that must be queried to generate a nonce value as a first step of the authentication flow. The response contains the nonce value represented as a JSON string which can be used for only one authentication attempt.
					</p>

					<p>
						Example: GET request to https://app.franklychat.com/auth/nonce to get a nonce value.
					</p>


<pre class="prettyprint"><code>
	$ curl -X GET https://app.franklychat.com/auth/nonce
	"054afc088ea94717aa6121768f13a57a"
</code></pre>

				</div>
		

				<div class="section" id="Generate_Identity_Token">
					<h4>
						2. Generate an Identity Token
					</h4>

					<p>
						After getting a nonce value from Frankly’s infrastructure, the partner app has to generate an identity token that embeds user’s information 
						and is signed using the <code>appSecret</code>.
					</p>


					<div class="panel panel-default note">
					  <div class="panel-body">
					    <b>Note</b>  Your app's <code>appKey</code> and <code>appSecret</code> can be found in the <a href="https://console.franklychat.com/">Frankly Admin Console</a>.
						To request an account, please contact us at <a href="mailto:platform-support@franklychat.com">platform-support@franklychat.com</a>.
					  </div>
					</div>


					<p>
						The JWT token must have the following structure:
					</p>


<pre class="prettyprint"><code>
	Header

	{
	  “typ”: “JWS”,
	  “alg”: “HS256”,
	  “cty”: “frankly-it;v1”
	}

	Claims

	{
	  “aak”: &lt;authentication key obtained from frankly admin console&gt;,
	  “uid”: &lt;unique user identifier&gt; (optional),
	  “iat”: &lt;token generation time as a unix timestamp&gt;,
	  “exp”: &lt;token expiration time as a unix timestamp&gt;,
	  “nce”: &lt;nonce value obtained in step 1&gt;,
	  “role”: ”admin” (optional)
	}

	Signature

	HMACSHA256(
	base64UrlEncode(Header) + "." +	base64UrlEncode(Claims),
	&lt;authentication secret obtained from frankly admin console&gt;
	)
</code></pre>


<br>


					<p>
						Once encoded and signed with the authentication secret the app should have a value that looks like this:
					</p>


<br>


<a id="identity_token">
<pre class="prettyprint"><code>
Identity Token

eyJ0eXAiOiJKV1MiLCJhbGciOiJIUzI1NiIsImN0eSI6ImZyYW5rbHktaXQ7djEifQ.eyJhYWsiOiIwMTIzNDU2Nzg5IiwidWlkIjoxMjM0NTY3ODkwLCJpYXQiOjEyMzQ1Njc4OTAsImV4cCI6MTIzNDU2Nzg5MCwibmNlIjoiMDU0YWZjMDg4ZWE5NDcxN2FhNjEyMTc2OGYxM2E1N2EifQ.BawHATknj5vTB5GF8yz0b-pAVidGF9enV0WBU6dirPo
</code></pre>
</a>

				</div>


				<div class="section" id="Generate_Session_Token">
					<h4>
						3. Generate a Session Token
					</h4>

					<p>
						After generating an identity token the app can then request a session token to be able to use Frankly’s API. Obtaining a session token can be done by querying https://app.franklychat.com/auth and setting the identity_token query string parameter to the value generated in step 2. This session token will come in the response as two cookies (token and xsrf) that the HTTP client should set whenever it attempts to use any of the Frankly API endpoints. Example: GET request on <a href="https://app.franklychat.com/auth">https://app.franklychat.com/auth</a>.
					</p>


<pre class="prettyprint"><code>
	$ curl -v -X GET https://app.franklychat.com/auth?identity_token=...
	&gt; GET /auth?identity_token=... HTTP/1.1
	&gt; Host: app.franklychat.com
	&gt; ...
	&gt; 
	&lt; HTTP/1.1 200 OK
	&lt; Set-Cookie: token=&lt;session token&gt;
	&lt; Set-Cookie: xsrf=&lt;xsrf token&gt;
	&lt; ...
	&lt;
</code></pre>
			
				</div>


		</div>
		

		<div class="section" id="Authentication_Behavior">
			<h3>
				Understanding Authentication Behavior
			</h3>
			
			<p>
				In order to best understand how to integrate the optimal authentication flow for your app's experience, you should understand how the Frankly Chat Platform 
				defines the various user roles along with the permissions each role is given. This, along with the authentication information below, will also help you understand 
				how your app should respond to facilitate users being able to take the desired actions at the appropriate times.
			</p>
			
			
<br>


			<p>
				The Frankly Chat Platform supports various authentication flows to best support your app's user onboarding strategy. 
				Below, the client SDK authentication guides will illustrate how to define this behavior for your app's experience, but before 
				getting to that, here's a breakdown of the supported authentication flows along with the related user permissions based on each role.
			</p>
			
			<ul>
				<li><b>Guest Mode Only</b>
				<ul>
					<li>This is the option you would choose if your app doesn't have its own secured authetication method.</li>
					<li>In this scenario, here's a breakdown of the permissions each role is allowed:</li>
					<ul>
						<li>Spectator/Anonymous User</li>
						<ul>
							<li><i>Is able to...</i></li>
							<ol>
								<li>Read the Room List and any content in a public Room.</li>
							</ol>
						</ul>
						<li>Guest User</li>
						<ul>
							<li><i>Is able to...</i></li>
							<ol>
								<li>Read the Room List and any content in a public Room.</li>
								<li>Send chat messages and define a Display Name.</li>
								<li>Define a custom Profile Avatar.</li>
							</ol>
						</ul>
					</ul>
				</ul>
				</li>
				<li><b>Partner Authentication Only</b>
				<ul>
					<li>This is the option you would choose if you would not like a progressive authentication flow by not providing Guest Mode as an option to users in your app.</li>
					<li>In this scenario, here's a breakdown of the permissions each role is allowed:</li>
					<ul>
						<li>Spectator/Anonymous User</li>
						<ul>
							<li><i>Is able to...</i></li>
							<ol>
								<li>Read the Room List and any content in a public Room.</li>
							</ol>
						</ul>
						<li>Regular/Secured User</li>
						<ul>
							<li><i>Is able to...</i></li>
							<ol>
								<li>Read the Room List and any content in a public Room.</li>
								<li>Send chat messages and define a Display Name.</li>
								<li>Define a custom Profile Avatar.</li>
							</ol>
						</ul>
					</ul>
				</ul>
				</li>
				<li><b>Guest Mode + Partner Authentication</b>
				<ul>
					<li>This is the option you would choose if you would like a progressive authentication flow by providing Guest Mode as an option to users in your app.</li>
					<li>In this scenario, here's a breakdown of the permissions each role is allowed:</li>
					<ul>
						<li>Spectator/Anonymous User</li>
						<ul>
							<li><i>Is able to...</i></li>
							<ol>
								<li>Read the Room List and any content in a public Room.</li>
							</ol>
						</ul>
						<li>Guest User</li>
						<ul>
							<li><i>Is able to...</i></li>
							<ol>
								<li>Read the Room List and any content in a public Room.</li>
								<li>Send chat messages and define a Display Name.</li>
							</ol>
						</ul>
						<li>Regular/Secured User</li>
						<ul>
							<li><i>Is able to...</i></li>
							<ol>
								<li>Read the Room List and any content in a public Room.</li>
								<li>Send chat messages and define a Display Name.</li>
								<li>Define a custom Profile Avatar.</li>
							</ol>
						</ul>
					</ul>
					<li>With this option, you're able to choose which option, Guest Mose vs Partner Authentication Mode, you'd like to appear as 
						the primary experience when the user initiates an action that requires a greater permission level.</li>
					<li>Because, in this scenario, a user can log in as a Guest, if they attempt to define a custom Profile Avatar, for example, 
						the client SDK will ask your client how you'd like to respond which is where your client would logically prompt the user 
						to secure their account to complete the desired action.</li>
				</ul>
				</li>
			</ul>
			
		</div>


		<div class="section" id="client_auth">
			<h3>
				Handling Authentication in the Client
			</h3>

			<p>
				Now that your server knows how to communicate with Frankly servers as an authenticated application, let's make sure you're client is able to get the right information to interact with the Frankly SDK. 
			</p>

		</div>
	
	
			<div class="section" id="ios_auth">
				<h4>
					Authenticating the iOS SDK
				</h4>
	
				<p>
					Set the FranklySDK’s <code>authenticationDelegate</code> to an object that conforms to the <code>FranklySDKAuthenticationDelegate</code> 
					protocol. Then call <code>initiateAuthenticationWithNewSession:</code>. Passing in YES will cause the SDK to go through the full 
					authentication flow including a request for <code>identifierWithNonce:preferredRole:completion:</code>. Passing in NO will attempt to use 
					an existing session, that was stored from a previous authentication. If that session exists, you will not recieve a request for 
					<code>identifierWithNonce:preferredRole:completion:</code> but will still receive the <code>authenticationDidSucceedWithUserID:</code> or 
					<code>authenticationDidFailWithError:</code> callback. 
				</p>
		
				<p>
					In our example code, we’ve made our <code>ViewController</code> conform to the protocol:
				</p>


<br>


<pre class="prettyprint"><code class="lang-cpp">
	@interface ViewController : UIViewController &lt;FranklySDKAuthenticationDelegate&gt;
</code></pre>


<br>

				<p>
					Set the Frankly SDK <code>authenticationDelegate</code> and initiate authentication as follows:
				</p>


<br>


<pre class="prettyprint"><code class="lang-cpp">
- (void)viewDidLoad {

	[super viewDidLoad];

	[FranklySDK sharedInstance].authenticationDelegate = self;

	// set the log in behavior here - see above for more information
	[FranklySDK sharedInstance].loginBehavior = FRSDKLoginBehaviorPartner

	// passing YES is necessary for a role upgrade but, for an existing user, who has already 
	// authenticated, passing NO will authenticate more quickly using the existing session
	[[FranklySDK sharedInstance] initiateAuthenticationWithUserID:&lt;partner user id&gt; role:FRSDKAuthenticationRoleUser];

}
</code></pre>


<br>


			<div class="panel panel-default note">
			  <div class="panel-body">
			    <b>Note</b> Roles determine which features the user can access, based on the authentication behavior your app supports. 
				Please see <a href="#Authentication_Behavior">Understanding Authentication Behavior</a> for more information.
			  </div>
			</div>
			
			
<br>


				<p>
					Next you will need to set up the following:
				</p>	
			
					<ol>
						<li><code>FranklyAuthenticationDelegate</code> requires the following functions:
							<ul>
								<li><code>(- (void)identityTokenWithNonce:(NSString *)nonce preferredRole:(FRSDKAuthenticationRole)preferredRole completion:(void (^)(NSString *identityToken, NSString *partnerUserId))completion</code></li>


<br>


								<p>
									This method is where you should utilize your back end server as detailed above, under <a href="#auth_flow">Server 
									Authentication Flow</a>, to create a valid identifier. The <code>uid</code> field in the identifier is optional, however, 
									the identifier is still necessary. If you choose not to include a <code>uid</code> then the user will only be allowed in 
									Spectator Mode. If a user in Spectator Mode attempts to participate it will trigger a call to the delegate’s 
									<code>doUserAuthentication</code> method at which point you should present a login screen. When your server responds with 
									the identity token, call completion to finish the authentication process. The preferred role is a suggestion from the 
									client SDK but your server, as long it includes a valid <code>uid</code>, may choose to put any role in the role field of 
									the <code>identityToken</code> and the SDK will honor that.
								</p>


<br>

							
								<div class="panel panel-default" style="margin-right:100px">
								  <div class="panel-body">
								    <b>Note</b>
									<ol>
										<li>You must call completion or the process will never finish.</li>
										<li>The <code>partnerUserId</code> string is an identifier that the partner app uses to identify the user. Frankly SDK 
											will correlate it with a Frankly identifier.</li>
									</ol>
								  </div>
								</div>

								
								<li>We have included a test function in <code>FranklySDK.h</code>, 
									<code>retrieveIdentityTokenWithUserID:Nonce:authKey:authSecret:role:completionBlock</code>, that will allow you to bypass  
									your server and retrieve an identifier from Frankly’s servers. Because it requires putting in your <code>appKey</code> and 
									<code>appSecret</code>, it is only for testing.</li>
							</ul>
							</li>


<br>


<pre class="prettyprint"><code class="lang-cpp">
- (void)identifierWithNonce:(NSString *)nonce preferredRole:(FRSDKAuthenticationRole)preferredRole completion:(void (^)(NSString *identifier))completion;


    FranklySDK *franklySDK = [FranklySDK sharedInstance];

    // ONLY FOR TESTING - REQUEST IDENTIFIER FROM YOUR SERVER 
    [franklySDK retrieveIdentityTokenWithUserID:self.userId
                                         Nonce:nonce
                                       authKey:self.authKey
                                    authSecret:self.authSecret
                                    	  role:FRSDKAuthenticationRoleUser
                               completionBlock:^(NSString *identifier, NSError *error) {
        if (identifier != nil) {
            completion(identifier, nil);
        }
    }];
}
</code></pre>


<br>


							<li><code>authenticationDidSucceedWithUserID:(NSNumber*)</code> - After this message is received, you may use the SDK.</li>


<pre class="prettyprint"><code class="lang-cpp">
- (void)authenticationDidSucceedWithUserID:(NSNumber *)userID {

	NSLog(@"authentication did succeed");

}
</code></pre>


							<li><code>authenticationDidFailWithError:(NSError*)</code> - If this message is received, you need to start authentication process 
								over before you may use the SDK.</li>


<pre class="prettyprint"><code class="lang-cpp">
- (void)authenticationDidFailWithError:(NSError *)error {

	NSLog(@"authentication did fail");
}
</code></pre>

					</ol>


<br>


					<p>
						Once you're done setting up those pieces, try running the build.
					</p>

				
<br>

				
					<p>
						If your delegate receives the <code>doUserAuthentication</code> callback then you should present a login screen. 
						When the user has completed logging in, you should restart the authentication process by calling 
						<code>initiateAuthenticationWithNewSession:</code> and passing in <code>YES</code> to create a new session. 
					</p>
					
					
<br>


					<h5>
						<b>Logging Out</b>
					</h5>
					
					
					<p>
						The Frankly SDK will automatically trigger a logout at appropriate times, such as when it detects a new user is attempting to log in. 
						However, you can also manually trigger a logout at any time by calling:
					</p>
					
					
<pre class="prettyprint"><code class="lang-cpp">
- (void)logOut;
</code></pre>


			</div>
		
		
			<div class="section" id="android_auth">
				<h4>
					Authenticating the Android SDK
				</h4>

<br>

				<h5>
					<b>Setting up an IdentityTokenGenerator</b>
				</h5>
			
			
				<p>	
					The Frankly SDK needs a user's identity token for user authentication. To do this, you need to implement an 
					<code>IdentityTokenGenerator</code> class.
				</p>


<pre class="prettyprint"><code class="lang-java">
private class YourIdentityTokenGenerator extends BaseIdentityTokenGenerator {
    private static final User.Role DEFAULT_ROLE = ...

    protected YourIdentityTokenGenerator() {
        super(DEFAULT_ROLE);
    }

    @Override
    public String generateIdentityToken(final Context context, final String nonce) throws IOException {
        final User.Role suggestedRole = this.getRole();
        final String partnerUsername = this.getPartnerUsername();

        // Using the nonce, the suggested role, and the partner username (which is simply the
        // username of the current user that is unique to your app), retrieve an identity token
        // from your server.
        final String identityToken = [Server network request];

        return identityToken;
    }

    @Override
    public boolean supported(final User.Role role) {
        ...
    }
}
</code></pre>


<br>


				<div class="panel panel-default" style="margin-right:100px">
				  <div class="panel-body">
					<b>Note</b> The identity token is meant to be retrieved from the your servers rather than being generated within the app.
				  </div>
				</div>


<br>


				<p>
					The <code>supportedRole(Role)</code> method should be written to return <code>true</code> for all roles that are supported and <code>false</code> for all other roles. 
					The available roles in the system are defined in the <code>Role</code> enum as follows:
				</p>

			
<pre class="prettyprint"><code class="lang-java">
public enum Role {
    ADMIN, ANONYMOUS, GUEST, REGULAR
}
</code></pre>


				<p>
					After defining the <code>IdentityTokenGenerator</code> class, you must create an instance of the class and pass it into the 
					Frankly SDK’s <code>Authenticator</code> class. User information should be initialized before login. When the <code>suggestedRole</code> 
					or <code>partnerUsername</code> differs from what was previously passed in, the Frankly SDK immediately triggers a logout for the previous user:
				</p>


<br>


<pre class="prettyprint"><code class="lang-java">
YourIdentityTokenGenerator identityTokenGenerator = new YourIdentityTokenGenerator();

FranklySdk.setIdentityTokenGenerator(identityTokenGenerator);
FranklySdk.initAuthentication(suggestedRole, partnerUsername);
</code></pre>


<br>


				<h5>
					<b>Activity Declaration</b>
				</h5>
				
				<p>
					In order to make use of the activities provided by the Frankly SDK, you will need to add them to your <code>AndroidManifest.xml</code>. 
					In particular, you will need to add either the <code>ConditionalRoomListActivity</code> definition or the <code>RoomListActivity</code> 
					definition, depending on whether you are using Conditional Rooms or not, as well as the <code>RoomActivity</code> definition. The 
					<code>AndroidManifest.xml</code> definitions for all of these classes, as well as other details about them, can be found under 
					<a href="InitializeSDK.html#Initializing_Android">Basic Integration > Room List</a>.
				</p>


<br>


				<h5>
					<b>Requesting Callbacks</b>
				</h5>
			
				<p>
					<b>Login Request Callback</b> In order to handle user logins, you need to implement a <code>RequestCallback</code> and pass an instance of 
					it to <code>FranklySdk.setLoginRequestCallback(FranklySdk.RequestCallback)</code>:
				</p>
			

<br>

			
<pre class="prettyprint"><code class="lang-java">
private static class LoginRequestCallback implements FranklySdk.RequestCallback {
    @Override
    public void onRequest(final Context context) {
        final Intent intent = new Intent(context, YourLoginActivity.class);

        intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);

        context.startActivity(intent);
    }
}

private static final LoginRequestCallback LOGIN_REQUEST_CALLBACK = new LoginRequestCallback();

@Override
public void onCreate() {
    super.onCreate();

    FranklySdk.initialize(this);
    FranklySdk.setVerbose(true);
    FranklySdk.setLoginRequestCallback(LOGIN_REQUEST_CALLBACK);
}
</code></pre>


<br>


			<p>
				<b>Show Login Dialog Request Callback</b> The Frankly SDK provides a default login dialog for easy integration support of Guest Users by using 
				<code>FranklySdk.setShowLoginDialogCallback(FranklySdk.RequestCallback)</code>, but you can replace it with a custom implementation as well.
			</p>


<br>


			<h5>
				<b>Explicit Login & Logout</b>
			</h5>

			
			<p>
				If you setup a custom <code>IdentityTokenGenerator</code> with user information, the Frankly SDK will trigger a login automatically as soon as 
				it is needed. However, you can also explicitly trigger a login manually at any time by calling:
			</p>
			
			
<pre class="prettyprint"><code class="lang-java">
FranklySdk.login();
</code></pre>


<br>


			<p>
				Similarly, the Frankly SDK will automatically trigger a logout at appropriate times, such as when it detects a new user is attempting to log 
				in. However, you can also manually trigger a logout at any time by calling:
			</p>
			
			
<pre class="prettyprint"><code class="lang-java">
FranklySdk.logout();
</code></pre>


<br>


		</div>


			<div class="section" id="js_auth">
				<h4>
					Authenticating the JavaScript SDK
				</h4>
		
				<p>
					Here's how to perform authentication from a Node.js:
				</p>


<pre class="prettyprint"><code class="lang-js">
	var FranklyClient = require ( 'frankly-js' ) .FranklyClient

	var appKey = 'appKey from Frankly Console'
	var appSecret = 'appSecret from Frankly Console'

	var client = new FranklyClient()
	client.open (appKey, appSecret)
</code></pre>


<br>


				<p>
					When authenticating from a client application running in the browser the <code>appKey</code> and <code>appSecret</code> values shouldn't be 
					exposed and the application's backend servers must generate the identity token using the secret and return it to the client to successfully 
					authenticate.
				</p>
		
				<p>
					Here's how to perform authentication form a browser application:
				</p>
		

<pre class="prettyprint"><code class="lang-js">
var client = new frankly.FranklyClient

    client.open(function (nonce) {
        return new Promise(function (resolve, reject) {
            var req = new XMLHttpRequest()

            req.onreadystatechange = function () {
                if (req.readyState === 4) {
                    if (req.status === 200) {
                         resolve(req.responseText)
                    } else {
                         reject('something went wrong')
                    }
                }
            }

            req.open('https://partner.domain.com/identity-token?nonce=' + nonce)
            req.send()
        })
    })
</code></pre>


<br>


				<p>
					The client instance automatically performs reconnection and reauthentication when necessary so the method passed to 
					<code><a href="http://franklyinc.github.io/frankly-js/FranklyClient.html#open" target="_blank">FranklyClient#open</a></code> may be called multiple times.
				</p>
		
		</div>
		
		
			<div class="section" id="logging_out">
			
			</div>
			
		</div>
		

		<div class="section" id="webclient_auth">
			<h3>
				Authenticating with the Web Client
			</h3>
		
			<p>
				The Frankly Web App supports authenticated users by providing a way to customize the login process. You can allow your users to log in using 
				your custom interface by setting both the “Login URL” and the “Logout URL” in the <a href="https://console.franklychat.com/">Frankly Admin 
				Console</a> > Settings > Web App.
			</p>

		
<br>


			<h4>
				Login vs Logout URL
			</h4>
		
			<ul>
				<li>The “Login URL” is a page of your design that users will either enter their credentials for your system, or enter Guest Mode credentials, 
					in order to be authenticated by your system. This page is shown to your users within the app, as described below.</li>
				<li>The “Logout URL” is the page where users are redirected to when they choose to log out of the system. This page is typically used to log 
					the user out of your entire system, not just the Frankly Web App. An example of this behavior is given below.</li>
			</ul>

	
<br>	

		
			<p>
				In order to take advantage of this feature, your backend must follow the following directions.
			</p>
		
<br>
		
			<h4>
				1. Prepare Your Backend
			</h4>
	
			<p>
				If a “Login URL” is provided in the Admin Console, the user is shown this webpage (inside of an &lt;iframe&gt;) on top of the Frankly Web App 
				when they select “LOG IN”.
			</p>
		
<br>
	
			<figure>
					<img src="images/webapp_auth_1.png" style="border:1px" width="748">
					<figcaption><i>Figure 1: Frankly Web App Admin Console</i></figcaption>
			</figure>

			
<br>


			<figure>
					<img src="images/webapp_auth_2.png" style="border:1px" width="300">
					<figcaption><i>Figure 2: Example external login screen within Frankly Web App</i></figcaption>
			</figure>


<br>


			<p>
				Please note the following requirements when creating your login screen for the Web App:
			</p>
		
			<ul>
				<li>The &lt;iframe&gt; that holds the external login screen sits within a 335px × 550px container, and external login screens must render 
					correctly within this space.</li>
				<li>The external login screen must be served over a secure protocol (that is, using HTTPS) for security purposes. Pages served over plain HTTP 
					will not be able to authenticate with the Web App.</li>
			</ul>

		
<br>

		
			<p>
				The Frankly Web App appends <code>nonce</code> and <code>redirect_uri</code> query string parameters suffixed to the end of the “Login URL” 
				within the &lt;iframe&gt; displayed to the user. The &lt;iframe&gt; will display the URL in the form of:
			</p>

		
<pre class="prettyprint"><code>
{your_login_url}/?nonce={nonce_value}&amp;redirect_uri=https://app.franklychat.com/auth/redirect
</code></pre>


<br>


			<p>
				The nonce value is used to generate an identity token for the user’s session, which ensures that the generated identity token is only valid for 
				one-time identity validation. Note that the nonce expires <strong>5 minutes</strong> after it is generated, and therefore the Frankly Web App 
				will refresh the contents of the login window if it has been opened for more than 5 minutes without a submission. The <code>redirect_uri</code> 
				is a string for the Frankly Server endpoint which accepts the identity token. These details are described in further detail below.
			</p>


			<p>
				It is important that the page located at the  “Login URL” does not return  “X-Frame-Options” in its response header.  X-Frame-Options are used 
				to specify whether or not a web page can be rendered within an iframe of another web page. You can read more about X-Frame-Options and how they 
				are configured <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/X-Frame-Options">here</a>. As the “ALLOW-FROM” option is not 
				supported across browsers, we ask that you do not return “X-Frame-Options” in your headers at all. 
			</p>


<br>


			<h4>
				2. Authenticate Your Users
			</h4>
		
			<p>
				On your login page accessible via the “Login URL”, you need to allow users to sign in as “authenticated users” or “guest users” by either 
				collecting their credentials or checking the status of their current session. An example user story is outlined below.
			</p>
		
<br>

			<h5>
				<b>User Story - Step 1</b>
			</h5>
		
			<p>
				A user reaches the login screen by selecting the “LOG IN” button or the locked status bar at the bottom of the Web App.
			</p>
		
<br>

			<figure>
				<img src="images/webapp_auth_3.png" style="border:1px" width="500">
				<figcaption><i>Figure 3: Login points from Frankly Web App</i></figcaption>
			</figure>
		
<br>

			<h5>
				<b>User Story - Step 2</b>
			</h5>
		
			<p>
				The user is shown your login screen, as outlined in Section 1. This can either be a custom credential capturing screen (as seen in Figure 4) or b) a splash screen while the system authenticates from the user’s current session with other parts of your online ecosystem (as seen in Figure 5).
			</p>
		
			<figure>
				<img src="images/webapp_auth_2.png" style="border:1px" width="300">
				<figcaption><i>Figure 4: a) Custom Authentication Screen</i></figcaption>
			</figure>
		
<br>

			<figure>
				<img src="images/webapp_auth_4.png" style="border:1px" width="300">
				<figcaption><i>Figure 5: b) Sample screen to display while system authenticates</i></figcaption>
			</figure>

<br>
<br>

			<h5>
				<b>User Story - Step 3</b>
			</h5>
		
			<p>
				Your system captures the user’s credentials or session information, and makes a decision about whether they need to be authenticated or not. Once this has been completed, your system must confirm authentication to the Frankly Web App and redirect the page to the provided <code>redirect_uri</code>, as described in Section 3.
			</p>
		
<br>

			<h4>
				3. Confirm Authentication with Frankly
			</h4>
		
			<p>
				Once a user is authenticated on your backend, generate an identity token for the user using the “nonce” provided in Section 1.
			</p>
		
			<p>
				The identity tokens used by the Frankly Web App are in the JSON Web Token (JWT) format. JWT is a compact URL-safe means of representing claims 
				to be transferred between two parties. See <a href="#identity_token">above</a> for an example of an identity token. For more information, 
				please see the <a href="#jwt">JWT section above</a>.
			</p>
		
			<p>
				Once an identity token is generated, redirect the current request to the <code>redirect_uri</code> along with the generated identity token as 
				part of the query string with field name <code>identity_token</code>.
			</p>
		
			<p>
				You can redirect a page by getting the web server to set the HTTP Location header (read more about HTTP Location setting 
				<a href="https://en.wikipedia.org/wiki/HTTP_location">here</a>). We recommend using the HTTP status code 302 for this redirect within the 
				header. For example, if the <code>redicrect_uri</code> that is provided is “https://app.franklychat.com/auth/redirect” then an example server 
				response would look something like:
			</p>

	
<pre class="prettyprint"><code>
HTTP/1.1 302 Found
Location: https://app.franklychat.com/auth/redirect?identity_token={user’s_identity_token}
</code></pre>		

	
<br>


			<p>
				Be sure to append the identity token to the end of the <code>redirect_uri</code>, as demonstrated in the example above.
			</p>
		
			<p>
				Note that setting the Location header of a HTTP request is a secured mechanism, as JavaScript does not have access to the redirection and thus 
				has no way of accessing the identity token.
			</p>
		
		</div>


		<div class="section" id="security">
			<h3>
				A Note on Security
			</h3>

	
			<p>
				In all cases, your application's <code>appKey</code> and <code>appSecret</code> should NOT be stored on the client and your application's 
				backend servers should be responsible for generating identity tokens, using the <code>appSecret</code> to return it to the client to 
				successfully authenticate. Storing your application's <code>appKey</code> and <code>appSecret</code> exposes you to unnecessary security risks 
				where an attacker could obtain these values to communicate with Frankly services on your behalf. Please note that some examples do highlight 
				the ability to directly authenticate with Frankly services from your application's client, however these are also noted as examples meant for 
				checking progress of early integration steps.
			</p>
		</div>


<br>
<br>
<br>
<br>


		<div class="pager-container">
			<nav>
			  <ul class="pager">
			    <li class="previous"><a href="InitializeSDK.html"><span aria-hidden="true">&larr;</span> Initializing the SDK</a></li>
			    <li class="next"><a href="BasicIntegration.html">Basic Integration <span aria-hidden="true">&rarr;</span></a></li>
			  </ul>
			</nav>
		</div>
		
	</div>

</div>

	

<br>
<br>

</body>



</html>