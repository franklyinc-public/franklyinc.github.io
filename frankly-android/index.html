<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Frankly Android SDK</title>
    <meta name="keywords" content="Frankly Platform" />
    <link type="text/css" rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" type="text/css">
	<link href="../themes/prism.css" rel="stylesheet" />
	<title>Frankly Android SDK Integration Guide</title>
	
	
</head>


<body>



	<h1>
		Frankly Android SDK Integration Guide
	</h1>
<p><i>Last updated May 21, 2015</i></p>

<br>
<br>

	<h2>
		Outline
	</h2>

	<ul>	
		<li><a href="#integration">Integration</a>
		<li><a href="#create_sample_app">Creating a Sample App</a>
		<li><a href="#optional_config">Optional Configurations</a>
		<li><a href="#custom">Design Customization</a>
		<li><a href="#troubleshooting">Troubleshooting</a>
</ul>
	
<a id="integration">	
	<h2>
		Integration
	</h2>
	
<p>	
	Follow these steps below to integrate the Frankly Android SDK into your Android app.
</p>
</a>

<br>
<br>

<h3>						
	1. Download Frankly SDK into your libs
</h3>
	
<p>	
	Download <code>frankly-sdk-1.0.0.aar</code> into your app’s <code>libs</code> - <a href="https://www.dropbox.com/s/t31yn07eizz6yx7/Frankly_Android_SDK_1.0.0_20150522.zip?dl=0">click here</a>.
</p>

<br>
<br>

<h3>
	2. Configure build script
</h3>

<p>
Modify your app module's <code>build.gradle</code>.

<pre><code>
repositories {
    ...
    flatDir {
        dirs 'libs'
    }
}

dependencies {
    ...
    compile(name: 'frankly-sdk-1.0.0', ext: 'aar')
    compile 'com.android.support:appcompat-v7:22.0.0'
    compile 'com.google.code.gson:gson:2.3.1'
    compile 'org.apache.commons:commons-lang3:3.3.2'
    compile 'org.apache.commons:commons-io:1.3.2'
    compile 'org.apache.commons:commons-collections4:4.0'
    compile 'com.squareup.picasso:picasso:2.5.0'
    compile 'net.jodah:expiringmap:0.4.1'
}
</code></pre>

<br>
<br>

<h3>
	3. Configure the Content Provider
</h3>
	
<p>	
	Partners must declare the Frankly Android SDK’s content provider with their app’s package name as a prefix of the authorities value in the <code>AndroidManifest.xml</code> file:
</p>

<pre><code>
&lt;provider
        android:name="com.frankly.franklysdk.contentprovider.FranklySdkContentProvider"
        android:authorities="&lt;app_package_name>.contentprovider.FranklySdkContentProvider"/&gt;
</code></pre>

<p>
	where <code>&lt;app_package_name&gt;</code> is the package name of the app where the Frankly Android SDK is being integrated.
</p>

<br>
<br>

<h3>
	4. Setup an Authentication Listener
</h3>	
	
<p>	
	Partners must implement an <code>OnAuthenticationRequestListener</code> class to handle user authentication:
</p>

<pre><code>
private class MyOnAuthenticationRequestListener implements Authenticator.OnAuthenticationRequestListener {
    public void onAuthenticationRequest(final Authenticator authenticator, final String nonce) {
        // For security, post nonce to your backend to retrieve an identity token
        final String identityToken = "&lt;my_identity_token&gt;";

        try {
            authenticator.authenticate(identityToken);
        } catch (final IOException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>

<p>
	<strong>Note:</strong> The identity token is meant to be retrieved from the Partner’s servers rather than being hardcoded into the app.
</p>

<p>
	After defining the <code>OnAuthenticationRequestListener</code> class, Partners must create an instance of the class and pass it into the Frankly Android SDK’s Authenticator class:

<pre><code>
Authenticator authenticator = Authenticator.getInstance(context);
authenticator.setOnAuthenticationRequestListener(authenticationRequestListener);
</code></pre>

<br>
<br>

<h3>
	5. Configure the RoomListActivity
</H3>
	
<p>	
	<code>RoomListActivity</code> must be declared in app's <code>AndroidManifest.xml</code> file:

<pre><code>
&lt;activity
        android:configChanges="keyboardHidden|orientation|screenSize"
        android:label="&lt;room_list_title&gt;"
        android:name="com.frankly.franklysdk.app.RoomListActivity"
        android:parentActivityName="&lt;parent_activity&gt;"
        android:screenOrientation="portrait"
        android:theme="@style/FranklySdkTheme.White">
    &lt;meta-data
        android:name="android.support.PARENT_ACTIVITY"
        android:value="&lt;parent_activity>"/&gt;
&lt;/activity&gt;
</code></pre>

<p>
	where <code><room_list_title></code> is the title of <code>RoomListActivity</code> and <code>&lt;parent_activity&gt;</code> is the destination when the <code>RoomListActivity</code> is exited via "Up" navigation.
</p>

<br>
<br>

<h3>
	6. Place Chatroom List Kickoff Code
</h3>

<p>
	The Frankly Android SDK contains a <code>RoomListActivity</code> class which contains everything needed to show the chatroom list and allow the user to join any of the chatrooms:
</p>

<pre><code>
import com.frankly.franklysdk.app.RoomListActivity;
...
Intent intent = new Intent(context, RoomListActivity.class);
context.startActivity(intent);
</code></pre>

<br>
<br>

<a id="create_sample_app">
<h2>
	Creating a Sample App
</h2>
	
<p>
	<ol>
		<li>Create empty project in AndroidStudio
		<li>Download and import sample app <code>File > New Module > Import Existing Project > folder of unzipped sample.zip</code>
	</ol>
</p>
</a>

<br>
<br>

<a id="optional_config">
<h2>
	Optional Configurations
</h2>

<h3>	
	Configure Application Server
</h3>

<p>	
	Partners can choose to specify the Frankly Android SDK to connect to either the test servers or production servers, or have the SDK automatically decide which servers to connect to during development. This can be accomplished by specifying the following <code>meta-data</code> tag in the <code>AndroidManifest.xml</code> file:
</p>

<pre><code>
&lt;meta-data
    android:name="com.frankly.franklysdk.ServerGroup"
    android:value="prod|test|auto" /&gt;
</code></pre>


<table border="1" style="width:40%">
	<tr>
		<th>ServerGroup Value</th>
		<th>Meaning</th>
	</tr>		
	<tr>
		<td>prod</td>
		<td>Connect the app to the production servers.<br>
(<strong>NOTE:</strong> This is the default.)</td>
	</tr>
	<tr>
		<td>test</td>
		<td>Connect the app to the test servers.</td>
	</tr>
	<tr>
		<td>auto</td>
		<td>Apps with the debug flag set to true will connect to the test servers, while apps with the debug flag set to false will connect to the production servers.</td>
	</tr>
</table>
</a>

<br>
<br>

<a id="custom">
<h2>
	Design Customization
</h2>

<p>
To assist with allowing apps to provide their own basic customizations to existing Frankly Android SDK Views, Activities, and Fragments, the following styles can be overridden and specified by Partners in XML style files:
</p>

<pre><code>
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;resources&gt;
    &lt;color name="frankly_sdk_primary"&gt;#6600FF&lt;/color&gt;
&lt;/resources&gt;
</pre></code>
</a>

<br>
<br>

<a id="troubleshooting">
<h2>
	Troubleshooting
</h2>	
	
<br>
	
<h3>	
	Build fail by duplicated files copied in <code>META-INF</code>
</h3>

<p>	
	<i>Symptoms</i>
</p>

<pre><code>
Error:duplicate files during packaging of APK ...
    Path in archive: META-INF/NOTICE.txt
</pre></code>

<p>
or
</p>

<pre><code>
Error:Execution failed for task ':app:packageDebug'.
Duplicate files copied in APK META-INF/NOTICE.txt ...
</pre></code>

<p>
	<i>Solution</i>
</p>	

<p>	
Add <code>packagingOptions</code> into app's <code>build.gradle</code>.

<pre><code>
packagingOptions {
    exclude 'META-INF/LICENSE.txt'
    exclude 'META-INF/NOTICE.txt'
}
</pre></code>

<br>

<h3>
	Manifest Merger Failed
</h3>
	
<p>	
	<i>Symptoms</i>
</p>

<pre><code>
Manifest merger failed : Attribute application@icon value=(@mipmap/ic_launcher) from AndroidManifest.xml ...
</pre></code>

<p>
	<i>Solution</i>
</p>
	
<p>	
	Add <code>'tools:replace="android:icon"'</code> to element at <code>AndroidManifest.xml</code>
</p>	
	
<pre><code>
    &lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:tools="http://schemas.android.com/tools"
        ...&gt;
    &lt;application
        ...
        tools:replace="android:icon"&gt;
</pre></code>
	
<br>
		
<h3>
	<code>NullPointerException</code> from <code>FranklyClientDelegator.getInstance()</code>
</h3>

<p>
	<i>Symptoms</i>
</p>

<p>	
Caused by: <code>java.lang.NullPointerException:</code> Attempt to invoke virtual method <code>'java.lang.String android.net.Uri.getScheme()'</code> on a null object reference
</p>

<p>	
	at
</p>

<pre><code>	
	com.frankly.franklysdk.network.FranklyClientDelegator.getInstance(FranklyClientDelegator.java:86)
    …
</pre></code>

<p>
	<i>Solution</i>
</p>

<p>	
	Currently there is no production server prepared. Therefore, you should configure test server.
</p>

<pre><code>
&lt;meta-data
    android:name="com.frankly.franklysdk.ServerGroup"
    android:value="test"/&gt;
</pre></code>
</a>


<br>
<br>
<br>
<br>
<br>
		
</body>
</html>
	
	